<%- include('partials/header') %>
<div class="container p-4">
    <div class="row justify-content-center">
        <div class="col-lg-8" data-aos="fade-up">
            
            <div class="card border-0 shadow-lg rounded-4 overflow-hidden mb-4 position-relative">
                <div style="height: 150px; background: linear-gradient(135deg, #6c5ce7, #a29bfe);"></div>
                <div class="card-body p-4 text-center" style="margin-top: -80px;">
                    <div class="position-relative d-inline-block mb-3">
                        <img src="<%= user.profilePic %>" class="rounded-circle border border-4 border-white shadow" width="140" height="140" style="object-fit: cover; background: white;" id="previewImg">
                        <label for="fileInput" class="position-absolute bottom-0 end-0 bg-dark text-white rounded-circle p-2 shadow cursor-pointer hover-scale">
                            <i class="fas fa-camera"></i>
                        </label>
                    </div>
                    <h3 class="fw-bold mb-1"><%= user.fullname %></h3>
                    <p class="text-muted mb-3">@<%= user.username %> <span class="badge bg-<%= user.role=='admin'?'danger':'primary' %> rounded-pill ms-1"><%= user.role %></span></p>
                    
                    <div class="row g-3 justify-content-center mb-4">
                        <div class="col-4">
                            <div class="p-3 bg-light rounded-3">
                                <h5 class="fw-bold mb-0 text-primary"><%= user.sessions.length %></h5>
                                <small class="text-muted" style="font-size: 10px;">ACTIVE BOTS</small>
                            </div>
                        </div>
                        <div class="col-4">
                            <div class="p-3 bg-light rounded-3">
                                <h5 class="fw-bold mb-0 text-success"><%= projects.length %></h5>
                                <small class="text-muted" style="font-size: 10px;">SERVERS</small>
                            </div>
                        </div>
                        <div class="col-4">
                            <div class="p-3 bg-light rounded-3">
                                <h5 class="fw-bold mb-0 text-warning"><%= user.isPremium ? 'PRO' : 'FREE' %></h5>
                                <small class="text-muted" style="font-size: 10px;">PLAN</small>
                            </div>
                        </div>
                    </div>
                    
                    <button class="btn btn-outline-dark rounded-pill px-4 fw-bold" data-bs-toggle="modal" data-bs-target="#ticketModal">
                        <i class="fas fa-life-ring me-2"></i>Open Support Ticket
                    </button>
                </div>
            </div>

            <div class="card border-0 shadow-sm rounded-4 p-4" data-aos="fade-up" data-aos-delay="100">
                <h5 class="fw-bold mb-4"><i class="fas fa-user-edit text-primary me-2"></i>Edit Informasi</h5>
                <form action="/profile/update" method="POST" enctype="multipart/form-data">
                    <input type="file" name="profilePic" id="fileInput" class="d-none" accept="image/*" onchange="document.getElementById('previewImg').src = window.URL.createObjectURL(this.files[0])">
                    <div class="row g-3">
                        <div class="col-md-6">
                            <label class="form-label small text-muted fw-bold">Fullname</label>
                            <input type="text" name="fullname" class="form-control bg-light border-0" value="<%= user.fullname %>" required>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label small text-muted fw-bold">Username</label>
                            <input type="text" name="username" class="form-control bg-light border-0" value="<%= user.username %>" required>
                        </div>
                        <div class="col-12">
                            <label class="form-label small text-muted fw-bold">Email Address</label>
                            <input type="email" class="form-control bg-light border-0" value="<%= user.email %>" readonly>
                        </div>
                    </div>
                    <div class="text-end mt-4">
                        <button type="submit" class="btn btn-primary rounded-pill px-5 fw-bold shadow-sm">Simpan Perubahan</button>
                    </div>
                </form>
            </div>

        </div>
    </div>
</div>

<!-- Ticket Modal -->
<div class="modal fade" id="ticketModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content border-0 shadow-lg rounded-4">
            <div class="modal-header border-0">
                <h5 class="fw-bold">Contact Support</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <form action="/ticket/create" method="POST">
                <div class="modal-body">
                    <input type="text" name="subject" class="form-control bg-light border-0 mb-3" placeholder="Subject / Masalah" required>
                    <textarea name="message" class="form-control bg-light border-0" rows="5" placeholder="Jelaskan masalah anda secara detail..." required></textarea>
                </div>
                <div class="modal-footer border-0">
                    <button type="submit" class="btn btn-dark rounded-pill px-4 w-100">Kirim Tiket</button>
                </div>
            </form>
        </div>
    </div>
</div>

<%- include('partials/footer') %>
